# Claude 会话管理器

一个用于管理 Claude Code 历史对话记录的轻量化 Python GUI。

## 功能特性

- 📊 **会话浏览**：以表格形式查看所有 Claude 对话记录
- 🔍 **搜索过滤**：按对话名称、项目路径、Session ID 搜索
- 🗑️ **批量删除**：支持多选删除会话及其相关文件
- 📄 **详情查看**：双击查看完整对话内容或调试日志
- 📁 **文件统计**：查看每个会话的文件大小分布
- 🧹 **清理工具**：一键清理无索引的孤立文件

## 截图

### 主界面
```
┌─────────────────────────────────────────────────────────────────────┐
│  Claude 会话管理器                                  🔍 搜索: [   ] 🔄 │
├─────────────────────────────────────────────────────────────────────┤
│  ☑️ 全选  ☐ 取消全选  🗑️ 删除选中的会话  已选: 0  │  🧹 清理无索引数据     │
├─────────────────────────────────────────────────────────────────────┤
│  │  │  │  │  │  │  │  │  │                                          │
│  会话列表表格（左侧）                │  右侧面板：                       │
│  - 行号                           │  ├── 对话预览（上半部分）           │
│  - 对话名称                        │  └── 文件大小分布（下半部分）       │
│  - 文件类型（对话文件/本地命令）      │                                 │
│  - 时间                           │                                 │
│  - 文件大小                        │                                 │
│  - 项目路径                        │                                 │
│  - Session ID                     │                                 │
│                                                                     │
├─────────────────────────────────────────────────────────────────────┤
│  💡 双击对话可查看详情                                开发者信息  版本   │
└─────────────────────────────────────────────────────────────────────┘
```

## 环境要求

- Python 3.6+
- tkinter

## 安装

1. 克隆或下载此项目

2. 确保安装了 Python 3：
```bash
python --version
```

3. 无需额外依赖，使用 Python 标准库

## 使用方法

### 启动程序

**直接运行**
```bash
python claude_session_manager.py
```

### 基本操作

#### 1. 浏览会话

程序启动后自动加载所有 Claude 会话记录：
- 表格按优先级排序：有数据文件 > 本地命令 > 无数据
- 同类按时间倒序排列（最新的在上面）

#### 2. 查看详情

**单击会话**：在右侧面板查看预览和文件分布

**双击会话**：打开完整内容窗口
- 对话文件：显示完整对话历史
- 本地命令：显示调试日志

#### 3. 搜索会话

在搜索框输入关键词，实时过滤：
- 支持搜索对话名称
- 支持搜索项目路径
- 支持搜索 Session ID

#### 4. 批量删除

1. 点击第一列的勾选框选中会话
2. 点击"🗑️ 删除选中的会话"按钮
3. 确认后将删除：
   - 对话数据文件
   - Debug 日志
   - Session 环境
   - 文件历史
   - Todo 记录
   - History 索引条目

#### 5. 清理孤立文件

点击"🧹 清理无索引数据"可清理：
- 无 history.jsonl 索引指向的 Debug 文件
- 无索引指向的对话文件
- 无索引指向的 Session 环境目录
- 无索引指向的文件历史目录
- 空的项目目录


## 数据存储

程序读取 Claude Code 的默认数据目录：

| 平台 | 数据目录 |
|------|---------|
| macOS/Linux | `~/.claude/` |
| Windows | `%USERPROFILE%\.claude\` |

### 目录结构

```
~/.claude/
├── history.jsonl           # 会话索引文件
├── projects/               # 对话数据文件
│   └── [项目路径]/
│       └── [SessionID].jsonl
├── debug/                  # 调试日志
│   └── [SessionID].txt
├── session-env/            # Session 环境
│   └── [SessionID]/
├── file-history/           # 文件历史
│   └── [SessionID]/
└── todos/                  # Todo 记录
    └── [SessionID]-*.json
```

## 使用案例

### 案例 1：查找并删除测试会话

```markdown
## 步骤

1. 在搜索框输入测试会话的关键词（如 "/test"）
2. 找到想要删除的测试会话
3. 点击勾选框选中
4. 点击"删除选中的会话"按钮
5. 确认删除

## 结果

所有与该会话相关的文件都被彻底删除，释放存储空间。
```

### 案例 2：查看某次对话的完整内容

```markdown
## 步骤

1. 在列表中找到目标对话
2. 双击该对话行
3. 在弹出的窗口中查看完整对话历史
4. 可使用搜索功能查找特定内容
5. 点击"复制 Session ID"可复制会话ID到剪贴板

## 提示

- 对话文件显示：用户消息、Claude 回复、工具调用
- 本地命令显示：调试日志、错误信息、警告信息
```

### 案例 3：分析存储空间占用

```markdown
## 步骤

1. 点击任意会话行
2. 查看右下角的"文件大小分布"面板
3. 分析各部分文件的大小和占比

## 显示内容

- 💬 对话文件：对话数据大小
- 🐛 Debug 日志：调试日志大小
- 📦 Session 环境：环境文件大小
- 📜 文件历史：文件历史大小
- 📝 Todo 记录：Todo 记录数量和大小
- 💾 总大小：该会话总占用空间
```

## 注意事项

⚠️ **删除操作不可恢复**，请谨慎操作！

建议在批量删除前：
1. 确认选中的会话确实是想删除的
2. 重要会话建议先备份

## 许可证

MIT License

## 作者

Qzjzl20000

## 更新日志

### v2.3
- 新增行号列
- 新增文件类型列（对话文件/本地命令）
- 文件大小列改名，本地命令显示"-"
- 右侧面板增加文件大小分布统计
- 优化列顺序和布局

### v2.2
- 新增对话预览功能
- 新增文件大小统计面板

### v2.1
- 支持本地命令（Debug 日志查看）
- 优化去重逻辑（按 sessionId 取最新）

### v2.0
- 初始版本
- 基本会话管理功能

### v1.8
- 草稿版本
- 删除无索引Session的垃圾文件

### v1.5
- 草稿版本
- Session详情内容展示

### v1.2
- 草稿版本
- Session删除

### v1.0
- 草稿版本
- 基础UI
- Session检索和展示

