# Claude Session Manager

一个轻量级的 Python GUI 应用，用于管理 Claude Code 的历史对话记录。

---

## 功能特性

| 功能 | 描述 |
|------|------|
| 📊 **会话浏览** | 以表格形式直观展示所有 Claude 对话记录 |
| 🔍 **实时搜索** | 支持按对话名称、项目路径、Session ID 快速过滤 |
| 📄 **内容预览** | 单击即可预览对话内容或调试日志 |
| 👁️ **详情查看** | 双击打开完整对话窗口，支持搜索功能 |
| 🗑️ **批量删除** | 多选删除会话及其所有关联文件 |
| 📁 **空间分析** | 查看每个会话的文件大小分布 |
| 🧹 **垃圾清理** | 一键清理无索引的孤立文件 |

## 快速开始

### 环境要求

- Python 3.6 或更高版本
- tkinter（Python 标准库，通常随 Python 一起安装）

### 安装

```bash
# 克隆仓库
git clone https://github.com/Qzjzl20000/claude_session_manager.git
cd claude_session_manager

# 无需额外依赖，直接运行
python claude_session_manager.py
```

## 使用指南

### 界面布局

```
┌─────────────────────────────────────────────────────────────────────┐
│  Claude 会话管理器                              🔍 [搜索框]     [🔄]  │
├─────────────────────────────────────────────────────────────────────┤
│  [☑️全选] [☐取消] [🗑️删除] 已选:0              [🧹清理无索引数据]        │
├───────────────┬─────────────────────────────────────────────────────┤
│               │  ┌─ 对话预览 ─────────────────────────┐              │
│   会话列表    │  │                                    │              │
│   ┌─────┐    │  │  💬 对话预览 (20 条消息)             │              │
│   │行号  │    │  │                                   │               │
│   │对话  │    │  │  你: 请帮我...                     │               │
│   │类型  │    │  │  Claude: 好的...                  │               │
│   │时间  │    │  │                                   │               │
│   │大小  │    │  └───────────────────────────────────┘               │
│   │路径  │    │  ┌─ 文件大小分布 ────────────────────┐                 │
│   │ID   │    │  │  📁 会话文件分布                  │                 │
│   └─────┘    │  │  💬 对话文件: 156 KB (45%)       │                 │
│               │  │  🐛 Debug: 189 KB (54%)        │                 │
│               │  │  💾 总大小: 345 KB              │                 │
│               │  └────────────────────────────────┘                 │
├─────────────────────────────────────────────────────────────────────┤
│  💡 双击对话可查看详情                                开发者信息 版本号   │
└─────────────────────────────────────────────────────────────────────┘
```

### 常用操作

#### 查看会话详情

**单击** 会话行 → 右侧面板显示预览和文件分布

**双击** 会话行 → 弹出窗口查看完整内容
- 对话文件：显示完整对话历史（用户消息、Claude 回复、工具调用）
- 本地命令：显示调试日志（DEBUG、WARN、ERROR 信息）

#### 搜索会话

在顶部搜索框输入关键词，支持：
- 对话名称
- 项目路径
- Session ID

#### 批量删除

1. 点击第一列勾选框选择会话
2. 点击「🗑️ 删除选中的会话」
3. 确认后将彻底删除所有关联文件：
   - 对话数据文件
   - Debug 日志
   - Session 环境
   - 文件历史
   - Todo 记录
   - History 索引

⚠️ **删除操作不可恢复，请谨慎操作！**

#### 清理孤立文件

点击「🧹 清理无索引数据」可清理：
- 无 `history.jsonl` 索引的 Debug 文件
- 无索引指向的对话文件
- 无索引指向的 Session 环境
- 空的项目目录

## 数据存储

程序自动读取 Claude Code 的数据目录：

| 操作系统 | 数据目录 |
|---------|---------|
| macOS / Linux | `~/.claude/` |
| Windows | `%USERPROFILE%\.claude\` |

### 目录结构

```
~/.claude/
├── history.jsonl          # 会话索引
├── projects/              # 对话数据
│   └── [项目路径]/
│       └── [SessionID].jsonl
├── debug/                 # 调试日志
│   └── [SessionID].txt
├── session-env/           # Session 环境
├── file-history/          # 文件历史
└── todos/                 # Todo 记录
```

## 使用场景

### 场景 1：清理测试会话

当你用 Claude 测试了多次 `/commit` 命令后，产生了大量无用的测试会话：

1. 在搜索框输入 `/commit`
2. 勾选想要删除的测试会话
3. 点击「删除选中的会话」
4. 一次性清理所有测试记录

### 场景 2：查找历史对话

记得之前讨论过某个问题，但想不起来具体内容：

1. 在搜索框输入关键词（如项目名或问题描述）
2. 双击目标会话
3. 在详情窗口中使用搜索功能查找具体内容

### 场景 3：分析存储占用

Claude 数据占用空间过大，想查看哪些会话占用最多：

1. 逐个单击会话查看文件大小分布
2. 找到占用空间大的会话
3. 决定是否删除

## 常见问题

**Q: 程序启动后看不到任何会话？**

A: 请确保：
1. Claude Code 已正常运行过
2. 数据目录 `~/.claude/` 存在且有 `history.jsonl` 文件

**Q: 删除后能恢复吗？**

A: 不能。删除操作会彻底移除所有相关文件，请谨慎操作。建议删除前备份重要会话。

**Q: 支持哪些 Python 版本？**

A: Python 3.6 及以上版本。如果你的系统默认 Python 版本较低，请使用 `python3` 命令。

## 技术栈

- **语言**: Python 3
- **GUI 框架**: tkinter (Python 标准库)
- **平台**: macOS, Linux, Windows

## 许可证

MIT License

## 作者

Qzjzl20000 & Claude Code & GLM-4.7


## 更新日志

### v2.3
- ✨ 新增行号列
- ✨ 新增文件类型列（对话文件/本地命令）
- ✨ 右侧面板增加文件大小分布统计
- 🎨 优化列顺序和界面布局

### v2.2
- ✨ 新增对话预览功能
- ✨ 新增文件大小统计面板

### v2.1
- ✨ 支持本地命令（Debug 日志查看）
- 🐛 优化去重逻辑（按 sessionId 取最新）

### v2.0
- 🎉 初始版本发布
- ✨ 基本会话管理功能

### v1.8
- 草稿版本
- 删除无索引Session的垃圾文件

### v1.5
- 草稿版本
- Session详情内容展示

### v1.2
- 草稿版本
- Session删除

### v1.0
- 草稿版本
- 基础UI
- Session检索和展示

